%%January 20- 2002
%\documentclass[wrr]{agu2001}
\documentclass{report}


%\usepackage{natbibDK}
\usepackage{natbib}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[dvips]{graphicx}
\usepackage[T1]{fontenc}        %for danish letters
\usepackage[latin1]{inputenc}   %for danish letters


%%---------------------- For verification -----------------------------%%
\newcommand{\erf}{\operatorname{erf}}                   %new function names
\newcommand{\erfc}{\operatorname{erfc}}                 %new function names
\newcommand{\inverfc}{\operatorname{inverfc}}           %new function names
\newcommand{\inerfc}{\operatorname{i^nerfc}}            %repeated int of erfc
\newcommand{\imoneerfc}{\operatorname{i^{-1}efc}}       %repeated int erfc
\newcommand{\inmoneerfc}{\operatorname{i^{n-1}erfc}}
\newcommand{\izeroerfc}{\operatorname{i^0erfc}}
\newcommand{\ierfc}{\operatorname{ierfc}}
%%---------------------------------------------------------------------%%


\begin{document}

%% ------------------------------------------------------------------------ %%
%
%  TITLE
%
%% ------------------------------------------------------------------------ %%


\title{Formler til Milj\ostyrrelsen}

%% ------------------------------------------------------------------------ %%
%
%  AUTHORS AND AFFILIATIONS
%
%% ------------------------------------------------------------------------ %%

\author{Mikkel Mollerup}



\chapter{Solute movement}\index{solute movement}

\section{Advection-dispersion equation}\index{advection-dispersion
  equation}

For describing the solute movement, the soil matrix water is divided
into two parts, a mobile and an immobile part

\begin{equation}
\theta= \theta_{m} + \theta_{im}
\end{equation}
%
where $\theta_{m}$ and $\theta_{im}$ are the mobile and immobile
water content, respectively. The immobile part of $\theta$ is always
filled first. Reversely is the mobile part emptied first. Thus, the
immobile part of $\theta$ can be expressed as

%\begin{equation}
%\theta_{im}=
%\begin{cases}
%\theta & \text{for\ } \theta < \theta_{im,max} \\
%\theta_{im,max} & \text{for\ } \theta \geq \theta_{im,max}
%\end{cases}
%\end{equation}

\begin{equation}
\theta_{im}= \theta
\end{equation}

%
where the mobile part of $\theta$ can then expressed as
%
%\begin{equation}
%\theta_{m}=
%\begin{cases}
% 0 & \text{for\ } \theta < \theta_{im,max} \\
%\theta -\theta_{im,max} & \text{for\ } \theta \geq \theta_{im,max}
%\end{cases}
%\end{equation}
%%

\begin{equation}
\theta_{m}= 0
\end{equation}


The solute concentration is similarly divided into a part associated
with the immobile water, $C_{im}$ and a part associated with the
mobile water, $C_{m}$. Dividing the matrix water content into a
mobile and an immobile volume is somewhat inconsistent when
$\theta_{im,max}>\theta_r$ where $\theta_r$ is the residual water
content. When comparing to Richards' equation all water above
$\theta_r$ is subject to movement. From Richards' equation the Darcy
velocity can be calculated as $\mathbf{v}=\mathbf{q}/\theta$. The
flux, $\mathbf{q}$ as used for calculating the movement of solute in
the mobile volume is calculated as

%\begin{equation}
%\mathbf{q}_{m} =
%\begin{cases}
%\mathbf{0} & \text{for\ } \theta_{m} = 0 \\
%\mathbf{q} & \text{for\ } \theta_{m} > 0
%\end{cases}
%\end{equation}


\begin{equation}
\mathbf{q}_{m} = \mathbf{q}
\end{equation}

%
where the associated flow velocity is given as
%$\mathbf{v}_{m}=\mathbf{q}_{m}/\theta_{m}$

\begin{equation}
\mathbf{v}_{m}=\mathbf{q}_{m}/\theta_{m}
\end{equation}

Three physical processes can contribute to movement of solutes in
the matrix part (non macroporous part) of soil:

\begin{itemize}
\item advection\index{advection}
\item molecular diffusion\index{molecular
    diffusion}\index{diffusion!molecular}
\item hydrodynamic dispersion\index{hydrodynamic
    dispersion}\index{dispersion!hydrodynamic} (only in connection
  with advection)
\end{itemize}

Advection\index{advection} (or bulk flow\index{bulk flow}) is the
process where the dissolved chemical moves with the soil solution.
The flux of solute can be described as:

\begin{equation}
\mathbf{j}=\mathbf{q}_{m}C_{m}
\end{equation}

The Molecular diffusion is a result of the Brownian
motion\index{Brownian motion} (random walk)\index{random
  walk} of the molecules. A process related to the movement of the
water is the hydrodynamic dispersion, which is a consequence of the
fact that flow is not uniform, because the flow paths move around
obstacles and air, but also because of variation in pore size and
the nonuniform velocity distribution inside the pores.
Mathematically the hydrodynamical dispersion process can be
described as a diffusion process. The movement by diffusion like
processes can be expressed as:

\begin{equation}
\mathbf{j}=-\theta_m \mathbf{D}\nabla C_{m}, \ \ \ \
\mathbf{D}=\begin{bmatrix}
D_{xx} & D_{xz}\\
D_{zx} & D_{zz}
\end{bmatrix}
\end{equation}
%
where $\mathbf{D}$ is the dispersion tensor\index{dispersion!tensor}
(or matrix). The consequence is that the solute tries to move from
areas with high concentration to areas with lower concentration. The
elements in $\mathbf{D}$ are often calculated as:

\begin{equation}
\begin{split}
&D_{xx}=\alpha_L\frac{v_{m,x}^{2}}{|\mathbf{v}_{m}|}+\alpha_T\frac{v_{m,z}^{2}}
{|\mathbf{v}_{m}|}+D^* \\
&D_{zz}=\alpha_L\frac{v_{m,z}^{2}}{|\mathbf{v}_{m}|}+\alpha_T\frac{v_{m,x}^{2}}
{|\mathbf{v}_{m}|}+D^* \\
&D_{xz}=D_{zx}=(\alpha_L-\alpha_T)\frac{v_{m,x}v_{m,z}}{|\mathbf{v}_{m}|}
\end{split}
\end{equation}
%
where $D^*$ is the molecular diffusion. The rest of the terms are
arising from the hydrodynamic dispersion. $\alpha_L$ is called the
longitudinal dispersion\index{dispersion!longitudinal} and
$\alpha_T$ the transversal dispersion\index{dispersion!transversal}.
The molecular diffusion can be calculated as:

\begin{equation}
D^*=\tau D_0
\end{equation}
%
where $D_0$ is the diffusion
coefficient\index{diffusion!coefficient} for the solute in free
water and $\tau$ is the tortuosity factor\index{tortousity factor}.
As an example \cite{Millington}\index{Millington \& Quirk} sugested:

\begin{equation}
\tau=\frac{\theta_{m}^{7/3}}{\theta_s} \label{eq:Millington}
\end{equation}
%
If we are using equation (\ref{eq:Millington}) and expressing the
mean velocity in the pores associated with solute movement by
$\mathbf{q}_{m}$ and $\theta_{m}$, the elements of
$\theta_{m}\mathbf{D}$ can be expressed as:

\begin{equation}
\begin{split}
&\theta_{m}
D_{xx}=\alpha_L\frac{q_{m,x}^{2}}{|\mathbf{q}_m|}+\alpha_T\frac{q_{m,z}^{2}}
{|\mathbf{q}_{m}|}+D_0\frac{\theta_{m}^{10/3}}{\theta_s} \\
&\theta_{m}
D_{zz}=\alpha_L\frac{q_{m,z}^{2}}{|\mathbf{q}_{m}|}+\alpha_T\frac{q_{m,x}^{2}}
{|\mathbf{q}_{m}|}+D_0\frac{\theta_{m}^{10/3}}{\theta_s} \\
&\theta_{m} D_{xz}=\theta_{m}
  D_{zx}=(\alpha_L-\alpha_T)\frac{q_{m,x}q_{m,z}}{|\mathbf{q}_{m}|}
\end{split}
\label{eq:thetad}
\end{equation}

The solute movement can be expressed as a sum of the advection and
the diffusion process:

\begin{equation}
\mathbf{j}_{m}=\theta_{m} C_{m}\mathbf{v}_{m}
-\theta_{m}\mathbf{D}\nabla C_{m}=C_{m}
\mathbf{q}_{m}-\theta_{m}\mathbf{D}\nabla C_{m}
\label{eq:soltransport}
\end{equation}
%
The mass balance\index{mass balance!solute movement} for the solute
can be expressed as:

%\begin{equation}
%\frac{\partial (\rho_b C_a)}{\partial t}+ \frac{\partial (\theta
%  C)}{\partial t}=-\nabla \cdot \mathbf{j}- \Gamma C_{sink} +\theta
%  \mu_{l} +\rho_b \mu_{s}
%\label{eq:solmassbal}
%\end{equation}

\begin{eqnarray}
\frac{\partial (\rho_b C_a)}{\partial t} + \frac{\partial
(\theta_{m}
  C_{m})}{\partial t} + \frac{\partial (\theta_{im}
  C_{im})}{\partial t} + \frac{\partial (\theta_{mp}
  C_{mp})}{\partial t} \nonumber \\ =-\nabla \cdot \mathbf{j}_{m}-\nabla
  \cdot \mathbf{j}_{mp} - \Gamma
\label{eq:solmassbal_tot}
\end{eqnarray}
%
where $\rho_b$ is the soil bulk density and $C_a$ is the
concentration in the adsorbed phase\index{adsorption}. $\theta_{mp}$
is the volumetric water content in the macropore domain and $C_{mp}$
is the concentration. $\Gamma$ is the sink term of the solute.

For simplification of the solute movement model, the matrix water
flow and the solute movement is inside each time step considered as
decoupled from the immobile water, the adsorped phase and the
macropore domain. Thus, every exchange with the environment is based
on the state at start of the time step. The mass balance of
dissolved solutes in the mobile matrix water yields:

\begin{equation}
\frac{\partial (\theta_{m} C_{m})} {\partial t}
   =-\nabla \cdot \mathbf{j}_{m} - \Gamma_{m}
\label{eq:solmassbal_im}
\end{equation}
%
where $\Gamma_{m}$ is the sink term which remove solutes from the
mobile matrix water. The removed (or added) solute can be absorbed,
moved to the immobile water or the macropore domain or be subject to
chemical or biological reduction.

The boundary conditions to the equation specifies a combination of
$C_{m}$ and its derivative on the boundary. Also here, the
\textit{Dirichlet} boundary condition\index{Dirichlet boundary
  condition}\index{boundary condition!Dirichlet} (specified
concentration) and the \textit{Neumann boundary
  condition}\index{Neumann boundary condition}\index{boundary
  condition!Neumann}, where the flux through the boundary is
specified, are common. The Dirichlet boundary condition is:

\begin{equation}
C_{m}=C_{m,0} \label{eq:Dirichlet_sol}
\end{equation}
%
where $C_{m,0}$ is the predescribed concentration. The Neumann
boundary condition is:

\begin{equation}
 \mathbf{\bar{n}}\cdot (C_{m}\mathbf{q}_{m}-\theta_{m}\mathbf{D}\nabla
 C_{m})=\mathbf{\bar{n}}\cdot \mathbf{j}_{m}=j_{m}
\label{eq:Neumann_sol}
\end{equation}
%
where $j_{m}$ is the size of the flux, positive for outward flux. As
boundary condition for the ingoing flow
$j_{m}=\mathbf{\bar{n}}\cdot\mathbf{q}_{m}C_{m,0}=q_{m}C_{m,0}$ is
often used where $C_{m,0}$ is the concentration of the flow. As
lower or downstream boundary condition
$j_{m}=\mathbf{\bar{n}}\cdot\mathbf{q}_{m}C_{m}=q_{m}C_{m}$ is often
used. In both cases it is assumed that the diffusion crossing the border is zero.\\
\\
Summarized, the problem to be solved for determination of the
concentration of solute in $\Omega$ is:

%\begin{equation}
%\begin{cases}
% \theta_{m} \frac{\partial C_{m}}{\partial t} + C_{m} \frac{\partial
%  \theta_{m}}{\partial t} =  -\nabla \cdot(C_{m}
%  \mathbf{q}_{m}-\theta_{m}
%  \mathbf{D}\nabla C_{m})- \Gamma_{m} &
%  \text{in} \ \Omega \\
% \mathbf{\bar{n}}\cdot (C_{m}\mathbf{q}_{m}-\theta_{m}\mathbf{D}\nabla C_{m})=j_{m} &
%  \text{on}\  \partial\Omega_1 \\
% C_{m}=C_{m,0} & \text{on}\ \partial\Omega_2
%\end{cases}
%\label{eq:solutemovement}
%\end{equation}
%


\begin{equation}
 \theta_{m} \frac{\partial C_{m}}{\partial t} + C_{m} \frac{\partial
  \theta_{m}}{\partial t} =  -\nabla \cdot(C_{m}
  \mathbf{q}_{m}-\theta_{m}
  \mathbf{D}\nabla C_{m})- \Gamma_{m}
\label{eq:solutemovement}
\end{equation}



where $\partial \Omega_1$ is the part of the boundary with Neumann
condition, and $\partial \Omega_2$ is the part of the boundary with
Dirichlet boundary conditions. Also here it is not necessary that
$\partial \Omega_1$ and $\partial \Omega_2$, respectively, are
coherent.


%\subsection{Special solution of the advection-dispersion equation}
%
%For some special cases, equation (\ref{eq:solutemovement}) can
%be rewritten so it is linear even though some adsorption and
%chemical processes take place. As a consequence, the
%$\Gamma_{m}$-term is omitted, the equation is in general linear
%of $C_{m}$ and not
%only within a time step.\\
%\\
%The advection-dispersion equation can still be considered as linear
%if we have a case:
%
%\begin{itemize}
%\item without macropore flow ($\theta_{mp}\equiv 0$)
%\item without immobile water ($\theta_{im}\equiv 0$)
%\item with linear adsorption
%\item with zero or first order chemical reactions
%\item without chain reactions
%\end{itemize}
%%
%For this case and with steady state water flow (i.e. $\partial
%\theta_{m} / \partial t=0$ and constant $\mathbf{q}$) a number of
%analytical solutions and semianalytical solutions exists
%\citep[e.g.][]{vanGenuchten}.\\
%\\
%If the adsorption process is very fast, the amount of adsorbed
%solute can be expressed with a adsorption
%isotherm\index{adsorption!isotherm} which is a relationship
%between adsorbed ($C_a$) and dissolved concentration, $C_m$.
%The bulk density is assumed to be constant through time. The two
%first terms of the left hand side of equation \ref{eq:solmassbal_tot}
%can be rewritten as:
%
%\begin{equation}
%\begin{split}
%&\rho_b\frac{\partial C_a}{\partial t}+\frac{\partial
% (C_{m}\theta)}{\partial t}=\rho_b\frac{\partial C_a}{\partial
%  C}\cdot \frac{\partial C_{m}}{\partial t}
%+\theta_{m} \frac{\partial C_{m}}{\partial t}+ C_{m}\frac{\partial
% \theta_{m}}{\partial t} = \\
%&\theta R \frac{\partial C_{m}}{\partial t} + C_{m} \frac{\partial
 % \theta_{m}}{\partial t}
%\end{split}
%\label{eq:retardation}
%\end{equation}
%
%where $R$ often in the literature is called the
%\textit{Retardation
%  factor}\index{retardation factor}:
%%
%\begin{equation}
%R=\frac{\rho_b}{\theta_{m}} \cdot \frac{\partial C_a}{\partial
%C_{m}}+1 \label{eq:retardationfactor}
%\end{equation}
%%
%The most simple adsorption isotherm is the linear adsorption where
%$C_a=K_dC_{m}$ and as a consequence
%$R=1+\frac{\rho_bK_d}{\theta_{m}}$. \\
%\\
%
%Zero or first order kinetics are included in the model. In zero
%order kinetics\index{kinetics!zero order}, the velocity of the
%reaction is independent of the concentration and in 1.st order
%kinetics\index{kinetics!first order} the reaction velocity is
%proportional to the concentration. Thus the advection dispersion
%equation yields:
%
%\begin{equation}
%\begin{split}
% R\theta_{m} \frac{\partial C_{m}}{\partial t} +& C_{m} \frac{\partial
% \theta_{m}}{\partial t} =  -\nabla \cdot(C_{m}
%  \mathbf{q}_{m}-\theta_{m} \mathbf{D}\nabla C_{m})- \theta_{m} \mu_l C_{m} +
%  \rho_b \mu_s
%\label{eq:advdisp}
%\end{split}
%\end{equation}
%
%where the second last term represents a first order production in
%the liquid phase.  $\mu_l$ is the rate constant. An often-used term
%is the half-life\index{degradation!half-life}. In a batch experiment
%the half-life is the time required for the mass of reacting materiel
%to decrease to half the original mass. The reaction half-life can be
%calculated as $t_{1/2}=ln(2)/\mu_l$. The equation can be used for
%many chemical processes, and for radioactive decay\index{radioactive
%decay}. The last term on the right hand side of equation
%\ref{eq:advdisp} represents a zero order removal from the solid to
%the liquid phase. $\mu_s$ is the rate constant for the zero order
%process.



\section{Numerical solution}

The basic principles behind the finite volume modeling of the solute
transport is very similar to the numerical solution of the water
movement equation (Richards' equation). But there are some
differences. One of the major differences is that the advection
diffusion equation is considered as linear inside each timestep.
I.e. coefficients in the equation in each timestep is independent of
the concentrations in the current timestep. This simplification can
be done when the size of the sources are dependent only on the
concentrations in the previous timstep. Similar are adsorption added
as sink/source term. Thus different from the water movement
simulation, the Picard iterations loop used inside each timestep can
be avoided.



\subsection{Stabilization methods}

There is often a lot of numerical problems involved with the solving
of the convection diffusion problem especially when the problems
are dominated by convection. The numerical solutions have often
unexpected oscillations in that situation. There have been developed
a lot of more or less complicated methods to reduce the problems.
Three of the methods are \textit{upstream weighting},
\textit{streamline diffusion}, and \textit{timestep reduction}.



\subsubsection{Upstream weighting}

When steep concentration fronts occur, numerical oscillations can
raise. A method to stabilize the system is to apply upstream
weighting for the advective solute movement. For advective
transport between two cells is the concentration at the face
between the cells normally calculated as the average concentration
of the two cells. For fully upstream weighting is the concentration at
the cell face equal to the upstream concentration. \\
\\
In Daisy2D it is possible to set a parameter,  $0\leq \alpha \leq 1$
where $\alpha=1$ corresponds to a fully upstream weighting and
$\alpha=0.5$ corresponds to setting the cell face concentration to
the average concentration of the two cells. It is not recommended
to apply a $\alpha<0.5$.


\subsubsection{$P_e$ and $C_r$ numbers}

There are two different numbers which are important for the
stability. The \textit{Peclet number}:
%
\begin{equation}
P_e=v\Delta x/D
\label{eq:Peclet}
\end{equation}
%
where $v$ is the velocity, $\Delta x$ is the
 space increment and $D$ is the diffusion coefficient (including
molecular diffusion and hydrodynamic dispersion). The
\textit{Courant number} is defined as:

\begin{equation}
C_r=v\Delta t/\Delta x
\label{eq:Courant}
\end{equation}

Theoretical stability investigations are rather complicated, especially
in a two or three-dimensional space with heterogenous soil. Most of
the theoretical stability considerations are done for one-dimensional
flow with uniform velocity. The classical constraints for stability for
the standard Crank-Nicholson-Galerkin (Finite Element Method) is
$P_e\leq 2$ and $C_r \leq 1$, \cite{Perrochet}.\\
\\
It can easily be concluded that keeping the Courant number lower
than one is just a question of sufficiently small timesteps. But is it
possible to make a mesh which under all circumstances prevents
that the Peclet number raises over 2?. The peclet number for the
flow in the x-direction is:

\begin{equation}
\begin{split}
(P_e)_x&=\frac{q_x \Delta x}{\theta D_{xx}}=\frac{q_x \Delta x}{\alpha_L
  \frac{q_xq_x}{|\mathbf{q}|}+\alpha_T\frac{q_yq_y}{|\mathbf{q}|}+D_0\frac{\theta^{10/3}}{\theta_s}}\\
& <\frac{q_x \Delta x}{\alpha_T\frac{q_xq_x+q_yq_y}{|\mathbf{q}|}}
  = \frac{q_x \Delta x}{\alpha_T |\mathbf{q}|} \leq \frac{\Delta x}{\alpha_T}
\end{split}
\end{equation}

where it is assumed that $\alpha_L \geq  \alpha_T$. The same
procedure can of course be used to evaluate $(P_e)_y$. It can then
be concluded that the maximum Peclet number is lower than
$\Delta x /\alpha_T$. If the longitudinal dispersivity is 5 cm and the
transversal is 1/10 of the longitudinal and the maximum allowed
$P_e$ is 2 can it be concluded that the maximum side length of the
elements shall be approximately 1 cm. This will result in a very fine
mesh.\\
\\
Besides the upstream weighting method it is possible to choose
between 2 stabilizing methods:

\begin{enumerate}
\item Introducing extra diffusion in the streamline direction so
    $P_eC_r\leq\gamma$. Where $\gamma$ is the performance
    index. \item Varying the size of $\Delta t$ so
    $P_eC_r\leq\gamma$.
\end{enumerate}

It is of course also possible to deselect any stabilizing methods. The
last stabilizing method is straight forward, but the first deserves its
own subsection:

\subsubsection{Streamline diffusion}

For practical situation are there often stability so long $P_eC_r\leq
 \gamma$ where $2\leq \gamma \leq 10$, \cite{Perrochet}  which under all
 circumstances is less restrictive than keeping both $P_e\leq 2$ and
 $C_r\leq 1$. $\gamma$ is called the \textit{performance index}.\\
\\
In the streamline diffusion is according to \cite{Perrochet} added
some additional longitudinal dispersion to prevent that $P_eC_r$
raises over the chosen performance index. The additional
longitudinal dispersion, $\bar{\alpha}_L$ is calculated as:

%\begin{equation}
%\bar{\alpha}_L=\begin{cases} \frac{|\mathbf{v}|\Delta
%    t}{\gamma}-\alpha_L-\frac{D^{*}}{|\mathbf{v}|}, & \text{for} \ \alpha_L +
%    \frac{D^{*}}{|\mathbf{v}|} < \frac{|\mathbf{v}|\Delta t}{\gamma}
% \\ 0, & \text{for} \ \alpha_L +
%    \frac{D^{*}}{|\mathbf{v}|} \geq \frac{|\mathbf{v}|\Delta
%    t}{\gamma}\end{cases}
%\end{equation}


\begin{equation}
\bar{\alpha}_L= \frac{|\mathbf{v}|\Delta
    t}{\gamma}-\alpha_L-\frac{D^{*}}{|\mathbf{v}|},
\end{equation}




\subsubsection{Stability tests}

To investigate the stability of the numerical model is a simple system
 modeled. The situation here is a one-dimensional column, horizontal
 column with steady-state water flow with pore velocity $v$. And a given
diffusion, $D$ (both molecular diffusion and hydrodynamic
dispersion). For the present test is the solute non-adsorping. For a
scenario with linear adsorping (constant retardation factor) the
adsorption have a stabilizing effect, thus for linear adsorping solutes
the model is expected to be more stable. The advection-dispersion
equation in one dimension can be written as:

\begin{equation}
\frac{\partial C_m}{\partial t}=D\frac{\partial^2C_m}{\partial
  x^2}-v\frac{\partial C_m}{\partial x}
\end{equation}

where $v=q\theta$. The initial condition is a zero concentration in
the whole column:

\begin{equation}
C_m(x,0)=0
\end{equation}

%\begin{equation}
%C(x,0)=C_i
%\end{equation}

At the left boundary is the solute flux constant.

%\begin{equation}
%\left(-D\frac{\partial C}{\partial x}+vC\right)\bigg\vert_{x=0}=\begin{cases} vC_0, &
% 0<t\leq t_0 \\ 0, & t>t_0 \end{cases}
%\end{equation}

\begin{equation}
\left(-D\frac{\partial C_m}{\partial x}+vC_m \right)\bigg\vert_{x=0}=vC_{m,0}
\end{equation}

The solution can then according to \cite{Genuchtenanalytical} be
written as:

\begin{equation}
\begin{split}
C_m(x,t) = &\frac{1}{2} C_{m,0}  \erfc\left
  [\frac{x-vt}{2(Dt)^{1/2}}\right]+\left(\frac{v^2t}{\pi
  D}\right)\exp\left[-\frac{(x-vt)^2}{4Dt}\right ] \\
&-  \frac{1}{2} C_{m,0} (1+\frac{vx}{D}+\frac{v^2t}{D})\exp(vx/D)\erfc\left[\frac{x+vt}{2(Dt)^{1/2}}\right]
\end{split}
\end{equation}

%\begin{equation}
%C(x,t)=\begin{cases}C_i+(C_0-C_i)A(x,t), & 0<t\leq t_0 \\
%  C_i+(C_0-C_i)A(x,t)-C_0A(x,t), & t>t_0 \end{cases}
%\end{equation}
%where:
%\begin{equation}
%\begin{split}
%A(x,t)=&\frac{1}{2} \erfc\left
 % [\frac{x-vt}{2(Dt)^{1/2}}\right]+\left(\frac{v^2t}{\pi
 % D}\right)\exp\left[-\frac{(x-vt)^2}{4Dt}\right ] \\
%&-\frac{1}{2}(1+\frac{vx}{D}+\frac{v^2t}{D})\exp(vx/D)\erfc\left[\frac{x+vt}{2(Dt)^{1/2}}\right]
%\end{split}
%\end{equation}

For the simulations is made a water flow situation with steady state
flow with the chosen pore water velocity $v=1$ cm/hour.
$C_{m,0}$ is for the simplicity chosen to 1 and $D=0.05$
cm$^2$/hour. For the Daisy simulations is the virtual soil column
10 cm wide and 1 cm high. On the domain is generated a regular
mesh with 100 equally large elements, each with $\Delta x=0.1$
cm. With $\Delta t$ chosen to 1 hour are $C_r=10$ and $P_e=2$,
i.e. $P_eC_r=20$. The numerical parameter, $\omega$ is set to
1/2, i.e. a
Crank-Nicholson scheme.\\
\\
In figure \ref{fig:Stab_Upstream} is the analytical solution
compared with numerical solutions with and without upstream
weighting corresponding to $\alpha=1$ and $\alpha=0.5$,
respectively. Streamline diffusion and timestep reduction has not
been applied. As it can be observed, are the wiggles significantly
smaller when applying upstream weighting. The only drawback
seems to be slightly more numerical diffusion compared with the
numerical solution for $\alpha=0.5$.

\begin{figure}[htbp]  %here-top-bottom-page
\includegraphics[width=\hsize]{Stab_Upstream.eps}
\caption{Analytical solution compared with numerical solution with regular weighting ($\alpha=0.5$)
and upstream weighting ($\alpha=1.0$). The solutions are shown as concentration as function of x after
simulation of 4 hours. For the actual case are $v=1$ cm/hour, $D=0.05$ cm$^2$/hour. For the numerical
simulations are $\Delta t=$ 1 hour and $\Delta x = 0.1$ cm, i.e. $P_e=2$ and $C_r=10$.}
\label{fig:Stab_Upstream}
\end{figure}


In the following cases upstream weighting has not been applied
($\alpha=0.5$).\\
\\
In figure \ref{fig:Stab_Methods} is the analytical solution shown.
Besides is the numerical solution shown for the cases: no
stabilization, timestep reduction and streamline diffusion. For both
the timestep reduction and streamline diffusion method is the
performance index, $\gamma=10$ chosen. For the simulation
without any stabilization are the wiggles significant. The wiggles are
smaller for the simulation with streamline diffusion. By comparing
with the analytical solution can the additional diffusion be observed.
The additional diffusions effectively reduced the $P_e$-number from
20 to 10. The remaining graph shows the simulation with the
timestep reduction stabilizing method where the size of $\Delta t$ is
changed so $P_eC_r\leq10$. Here the the size of the timestep is
reduced from $\Delta t=1$ hour (no stabilization) to 0.5 hour.
Effectively the $C_r$-number is reduced from 10 to 5, i.e. for the
computation is used 2 times so many timesteps (or approximately
2 times so long CPU-time). Compared with the numerical solution
without stabilization are wiggles reduced, but have also smaller
wavelength.\\
\\

\begin{figure}[htbp]  %here-top-bottom-page
\includegraphics[width=\hsize]{Stab_Methods.eps}
\caption{Analytical solution compared with different numerical solutions. The
solutions are shown as concentration as function of x after
simulation of 4 hours. For the numerical solution without
stabilization are $P_e=2$ and $C_r=10$.}
 \label{fig:Stab_Methods}
\end{figure}

In figure \ref{fig:Stab_TimeStepRed} is the analytical and numerical
solutions shown. The numerical solution are computed using
different performances indexes. The performance index, $\gamma$
is changed applying timestep reduction. It can be observed that the
wiggles are significant for $\gamma=10$, but for $\gamma=5$
(and lower) the size of the wiggles seems to be acceptable for
most purposes.


\begin{figure}[htbp]  %here-top-bottom-page
\includegraphics[width=\hsize]{Stab_TimeStepRed.eps}
\caption{Analytical solution compared with different numerical solutions
obtained using timestep reduction with varying performance index.
For the simulation are $v=1$ cm/hour and $D=0.05$ cm$^2$/hour. For the numerical
simulations are $\Delta x=$ 0.1 cm and $\Delta t$  is ranging from 1/10 hour ($\gamma=2$)
to 1/2 hour ($\gamma=10$).}
\label{fig:Stab_TimeStepRed}
\end{figure}

In figure \ref{fig:Stab_StreamDiff} is the analytical solution shown.
Also the numerical solution for varying performances indexes are
shown. The performance index, $\gamma$  is changed applying
streamline diffusion. The wiggles are reduced when using a low value
of $\gamma$, but compared with the analytical solution, the
steepness of the front is reduced dramatically.


\begin{figure}[htbp]  %here-top-bottom-page
\includegraphics[width=\hsize]{Stab_StreamDiff.eps}
\caption{Analytical solution compared with numerical solutions
obtained using streamline diffusion with varying performance
index. For the analytical solution are $v=1$ cm/hour and
$D=0.05$ cm$^2$/hour. For the numerical simulations are
$\Delta x=$ 0.1 cm and $\Delta t=$ 1 hour.}
\label{fig:Stab_StreamDiff}
\end{figure}


%XXXXXXXXXXXXXXXXXXXXXXXXX
%
%The different Peclet is made by screw on the diffusion. As it can be
%seen is there saw-tooth instabilities also called wiggles,
%\cite{Abbott} for the high Peclet numbers. As expected is the
%wiggles most significant for the high Peclet numbers. For $P_e=10$
%is it not possible immediate to observe instabilities on the graphs
%
%
%In figure \ref{fig:soltest1_sub} is shown simulation results for
%$C_r=0.1$ for different $P_e$-numbers. The different Peclet is made by
%screw on the diffusion. As it can be seen is there saw-tooth
%instabilities also called wiggles, \cite{Abbott} for the high
%Peclet numbers. As expected is the wiggles most significant for the
%high Peclet numbers. For $P_e=10$ is it not possible immediate to observe
%instabilities on the graphs.
%
%
%\begin{figure}[htbp]  %here-top-bottom-page
%\begin{center}
%%\epsffile{soltest1_sub.eps}
%\caption{FEM solutions shown as concentration as function of x after
%3 days(upper) and as function of time for $x=10$ cm (lower)
%There have been used different $P_e$-numbers. The Courant number,
%$C_r$ is 0.1. The wiggles are significant for large $P_e$-numbers}
%\label{fig:soltest1_sub}
%\end{center}
%\end{figure}

%In figure \ref{fig:soltest2_sub} is provided graphs for situations
%with constant Peclet number and varying Courant number. It can be seen
%that the size of the wiggles increases with the Peclet number. The
%Courant number is changed  by changing the size of the timestep,
%$\Delta t$ used in the modeling, i.e. the the physical properties of
%the flow is unchanged and the differences between the curves are all
%caused by numerical 'things'.

%\begin{figure}[htbp]  %here-top-bottom-page
%\begin{center}
%%\epsffile{soltest2_sub.eps}
%\caption{FEM solutions shown both as concentration as function of x
%for time=3 days (upper) and as function of time with x=10 cm
%(lower). There have been used different $C_r$-numbers. The Peclet
%number, $P_e$ is 20 for all the graphs.  It can be seen that the
%wiggles are significant for large $C_r$-numbers.}
%\label{fig:soltest2_sub}
%\end{center}
%\end{figure}

%Figure \ref{fig:soltest3_sub} shows results for different combinations
%of $P_e$ and $C_r$, but restricted so $P_eC_r=10$. For all the
%simulations are there significant wiggles, but the is for example no
%simple relationship between the Peclet number and the size of the
%saw-tooths. The simulations with $C_r=5$ is maybe also critical of the
%reason that the timesteps are to large compared with the time (2 days)
%for the injection of solute at the left boundary, but thats another
%thing.

%\begin{figure}[htbp]  %here-top-bottom-page
%\begin{center}
%%\epsffile{soltest3_sub.eps}
%\caption{FEM solutions shown both as concentration as function of x,
% time=3 days (upper) and as function of time with x=10 cm
%(lower). There have been used different $P_e$ and $C_r$-numbers, but
%$P_eC_r$ is equal 10 for all the figures.}
%\label{fig:soltest3_sub}
%\end{center}
%\end{figure}

%\begin{figure}[htbp]  %here-top-bottom-page
%\begin{center}
%%\epsffile{soltest4_sub.eps}
%\caption{Analytical and FEM solutions shown both as concentration as
%  function of x ,time=3 days (upper) and as function of time with x=10 cm
%(lower). For the FEM-simulations are used 3 different strategies. One
%without stabilization. One with streamline diffusion and lastly one
%with changing $\Delta t$ so $P_eC_r\leq \gamma$ ,$\gamma=5$.}
%\label{fig:soltest4_sub}
%\end{center}
%\end{figure}


\subsection{Upper boundary condition}


The upper boundary condition describes the movement of solute
applied at the surface that moves into the soil. It also describes the
movement of solutes out from the domain if the water is flowing
out at the upper boundary.\\

If the soil surface not is ponded, the flux into the soil is moved by
advection into the domain, with the water. If the surface is ponded
with water containing a solute, the solute is also moved solely by
advection. A little more accurate description could have been
obtained if the boundary condition was implemented as a Dirichlet
condition which also allowed the solute to be moved by dispersion
and diffusion into the soil. It is assessed that the error is
insignificant.\\
\\
When the water moving out of the domain. No solute is following
the water. This is for most solutes an good boundary condition - at
least for evaporation processes. For a situation with liquid water is
leaving the soil through the upper boundary the description is not
appropriate, but at present Daisy is not intended for that kind of
scenarios. Summarized the upper boundary condition can be
expressed as:
%
%\begin{equation}
%\left(-\theta_m D_{zz} \frac{\partial C_m}{\partial z}+q_zC_m \right) \bigg \vert_{z=z_{\text{surf}}}
%=\begin{cases} q_{\text{out}}C_{\text{surf}}, &
%  q_{\text{out}} < 0  \\ 0, & q_{\text{out}} > 0 \end{cases}
%\end{equation}
%

\begin{equation}
\left(-\theta_m D_{zz} \frac{\partial C_m}{\partial z}+q_zC_m
\right) \bigg \vert_{z=z_{\text{surf}}} =
q_{\text{out}}C_{\text{surf}}
\end{equation}


where $z_{\text{surf}}$ is the $z$-coordinate of the soil surface,
$q_z$ is the flow (positive upwards) and $q_{\text{out}}$ is the
flux out of the domain (negative for flux into the domain).
$C_{\text{surf}}$ is the concentration of the surface water. \\
\\
Numerically all the types of upper boundary conditions is
implemented as explicit Neumann conditions, i.e. the solute
movement over the boundary is independent of the solute
concentrations in the domain.



\subsection{Lower boundary condition}

The lower boundary condition describes the movement of solute
through the lower boundary. If the water have a free drainage
condition, there is a flux condition for the solute when the solute is
moved out of the domain by advection. If there is specified a
groundwater table or aquitard boundary condition, i.e. pressure
(Dirichlet) conditions for the water flow, also the solute movement
have a Dirichlet condition with a specified concentration at the
boundary. For a specified steady-state water flux (mostly used for
testing purposes). It is possible both to chose specified
concentration (Dirichlet) and flux boundary conditions. \\
\\
Numerically the Neumann boundary conditions is implemented,
either implicit or explicit - implicit when the water flux is outwarded
from the lower boundary and the concentration associated with the
flux is given by the concentration inside the domain. Explicit when
the water moves into the domain and the associated concentration
is the concentration outside the domain. \\
\\
The Dirichlet boundary condition is implemented as a explicit
Neumann boundary condition. Based on the solution in the previous
timestep the flux is calculated with the given concentration on the
boundary. The method is different from the method used for the
water movement, but prevents an extra iteration loop inside each
timestep with following increased computational times. In the water
movement simulations, the iteration loop was under all
circumstances necessary since the equation is non-linear. Otherwise
for the solute movement. But with very large concentration
gradients (and following large movement by diffusion and dispersion
processes) and small cells at the boundary some numerically
problems can occur. To prevent this kind of instability, the size of
the timesteps can be lowered if also timestep reduction is chosen as
stabilizing method to prevent to high $P_eC_r$-numbers. If
timestep reduction is chosen, the timestep is reduced so:

\begin{itemize}
\item  For diffusion into the cell, only half of the volume of the
    conc difference between border and cell can be transported by
    diffusion over the boundary into the cell in a timestep.
\item For diffusion out from the cell, only half of the volume of
    the conc difference between cell and border can be
    transported by diffusion over the boundary out from the cell in
    a timestep.
 \end{itemize}

To prevent to large computational times, the timestep can not be
lower than a chosen a minimum value. If the instabilities are high
and produce negative concentrations at the cells at the boundary,
the computations in the timestep is repeated and the solute is only
moved by advection over the boundary. This can happen if the
minimum value of the size of the timesteps is chosen to high.



\subsection{Verification: One-dimensional flow with retardation and degradation}

There are developed a lot of analytical solutions for the
one-dimensional convective-dispersive equation, see for example
\cite{Genuchtenanalytical}. The equations are developed for
situations where the diffusion is constant and the water flow is
steady state (i.e. $\partial \theta_{m} / \partial t=0$ and constant
$\mathbf{q}$). These conditions are seldom fulfilled in the 'real life'
where both the water content and the flux are time-dependent. For
testing the solute transport model is a situations with steady state
water movement simulated.\\
\\
If the adsorption process is very fast, the amount of adsorbed
solute can be expressed with a adsorption
isotherm\index{adsorption!isotherm} which is a relationship
between adsorbed ($C_a$) and dissolved concentration, $C_m$.
The bulk density is assumed to be constant through time. The two
first terms of the left hand side of equation
(\ref{eq:solmassbal_tot}) can be rewritten as:

\begin{equation}
\begin{split}
&\rho_b\frac{\partial C_a}{\partial t}+\frac{\partial
  (C_{m}\theta)}{\partial t}=\rho_b\frac{\partial C_a}{\partial
  C}\cdot \frac{\partial C_{m}}{\partial t}
+\theta_{m} \frac{\partial C_{m}}{\partial t}+ C_{m}\frac{\partial
  \theta_{m}}{\partial t} = \\
&\theta R \frac{\partial C_{m}}{\partial t} + C_{m} \frac{\partial
  \theta_{m}}{\partial t}
\end{split}
\label{eq:retardation}
\end{equation}
%
where $R$ often in the literature is called the \textit{Retardation
  factor}\index{retardation factor}:
%
\begin{equation}
R=\frac{\rho_b}{\theta_{m}} \cdot \frac{\partial C_a}{\partial
C_{m}}+1 \label{eq:retardationfactor}
\end{equation}
%
The most simple adsorption isotherm is the linear adsorption where
$C_a=K_dC_{m}$ and as a consequence
$R=1+\frac{\rho_bK_d}{\theta_{m}}$. \\
\\

Zero or first order kinetics are included in the model. In zero order
kinetics\index{kinetics!zero order}, the velocity of the reaction is
independent of the concentration and in 1.st order
kinetics\index{kinetics!first order} the reaction velocity is
proportional to the concentration. Thus the advection dispersion
equation yields:

\begin{equation}
\begin{split}
 R\theta_{m} \frac{\partial C_{m}}{\partial t} +& C_{m} \frac{\partial
  \theta_{m}}{\partial t} =  -\nabla \cdot(C_{m}
  \mathbf{q}_{m}-\theta_{m} \mathbf{D}\nabla C_{m})- \theta_{m} \mu_l C_{m} +
  \rho_b \mu_s
\label{eq:advdisp}
\end{split}
\end{equation}
%
where the second last term represents a first order production in
the liquid phase.  $\mu_l$ is the rate constant. An often-used term
is the half-life\index{degradation!half-life}. In a batch experiment
the half-life is the time required for the mass of reacting materiel to
decrease to half the original mass. The reaction half-life can be
calculated as $t_{1/2}=ln(2)/\mu_l$. The equation can be used for
many chemical processes, and for radioactive
decay\index{radioactive decay}. The last term on the right hand
side of equation (\ref{eq:advdisp}) represents a zero order
removal from the solid to the liquid phase. $\mu_s$ is the rate
constant for the zero order process. In \cite{Genuchtenanalytical}
is considered a one-dimensional case with degradation of both zero
and first order. The governing differential equation can then be
expressed as:

\begin{equation}
R\frac{\partial C_m}{\partial t}=D\frac{\partial^2C_m}{\partial
  x^2}-v\frac{\partial C_m}{\partial x}-\mu C_m +\gamma
\end{equation}

where $\mu$ is the rate constant for first order decay in the liquid
and $\gamma$ represents the similar rate constant for zero-order
production:

For the simulation, the initial condition is

\begin{equation}
C_m(x,0)=C_{m,i}
\end{equation}

and the upper boundary condition is

%\begin{equation}
%\left(-D\frac{\partial C_m}{\partial x}+vC_m\right)\bigg\vert_{x=0}=\begin{cases} vC_{m,0}, &
%  0<t\leq t_0 \\ 0, & t>t_0 \end{cases}
%\end{equation}

\begin{equation}
\left(-D\frac{\partial C_m}{\partial x}+vC_m\right)\bigg\vert_{x=0}=
vC_{m,0}
\end{equation}



The solution is

%\begin{equation}
%\begin{small}
%C_m=\begin{cases}\frac{\gamma}{\mu}+ (C_{m,i}-\frac{\gamma}{\mu})A(x,t)+(C_{m,0}-\frac{\gamma}{\mu})B(x,t), 0<t\leq t_0 \\
%\frac{\gamma}{\mu} + (C_{m,i}-\frac{\gamma}{\mu})A(x,t)+(C_{m,0}-\frac{\gamma}{\mu})B(x,t)-C_{m,0}B(x,t-t_0), t>t_0
%\end{cases}
%\end{small}
%\end{equation}


\begin{equation}
\begin{small}
C_m=\frac{\gamma}{\mu}+
(C_{m,i}-\frac{\gamma}{\mu})A(x,t)+(C_{m,0}-\frac{\gamma}{\mu})B(x,t),
0<t\leq t_0
\end{small}
\end{equation}

where $A(x,t)$ and $B(x,t)$ can be calculated as

\begin{equation}
\begin{split}
A(x,t) & =\exp(-\mu t/R)\cdot \\
& \bigg\{ 1-\frac{1}{2}\erfc\left[\frac{Rx-vt}{2(DRt)^{1/2}}\right]
-\left(\frac{v^2t}{\pi
    DR}\right)^{1/2}\exp\left[-\frac{(Rx-vt)^2}{4DRt}\right] \\ &
+\frac{1}{2}\left(1+\frac{vx}{D}+\frac{v^2t}{DR}\right)\exp(vx/D)\erfc\left[\frac{Rx+vt}{2(DRt)^{1/2}}\right]
\bigg\}
\end{split}
\end{equation}

\begin{equation}
\begin{split}
B(x,t)=&\frac{v}{v+u}\exp\left[\frac{(v-u)x}{2D}\right]\erfc\left[\frac{Rx-ut}{2(DRt)^{1/2}}\right]
+\\
&
\frac{v}{v-u}\exp\left[\frac{(v+u)x}{2D}\right]\erfc\left[\frac{Rx+ut}{2(DRt)^{1/2}}\right]
+\\ &
 \frac{v^2}{2\mu D}\exp\left[\frac{vx}{D}-\frac{\mu
     t}{R}\right]\erfc\left[\frac{Rx+vt}{2(DRt)^{1/2}}\right]
\end{split}
\end{equation}

with

\begin{equation}
u=v \sqrt{1+\frac{4\mu D}{v^2}}
\end{equation}


For comparing the analytical solution with the Daisy solution is
chosen an situation with $v=10$ cm/day, $D=5$, $\gamma=0.2$
and $\mu=0.5$. For the Daisy simulation is there used a vertical
column which is 100 cm high and 1 cm wide. The grid consisting of
100 1 X 1 cm cells. For the Daisy-modeling is used a similar mesh
as in the previous example just 100 cm long (and double so many
elements). The length of the timesteps, $\Delta t=1/10$ day. In
figure \ref{fig:solanalyt} is the Daisy solution compared with the
above described analytical solution. As it can be seen are the
solutions quite coincident.

\begin{figure}[h!]  %here-top-bottom-page
\begin{center}
%\epsffile{solanalyt.eps}
\caption{Comparison between analytical and Daisy simulation of a
process with both zero and first order degradation.}
\label{fig:solanalyt}
\end{center}
\end{figure}





%%------------------- For later use ------------------------%%
%\include{femtheory_MST}
%\include{verification_MST}
%%----------------------------------------------------------%%



%\section{Referencer}
%
%
%Liste med referencer:\\
%\\
%
%\begin{itemize}
%\item \citep{Mollerupphd}\\
%\item \cite{Philip} \\
%\item \cite{PhilipTrans,PhilipAus}
%\end{itemize}




% ------------------------------------------------------------------------ %%
%
%  REFERENCE LIST AND TEXT CITATIONS
%
%% ------------------------------------------------------------------------ %%


%\bibliographystyle{natbibDK}
\bibliographystyle{natbib}
\bibliography{MST}


\end{document}
