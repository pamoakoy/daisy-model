;;; test.dai -- Sample file using the Daisy libraries.

;; We try to run the same simulation with two different soil water
;; transport models.

;; Use standard parameterizations.
(input file "tillage.dai")
(input file "crop.dai")
(input file "log.dai")

;; Weather data.
(weather file "weather.clm"
  (DryDeposit (NO3 0.3e-6)	;[kg/m²/d]
	      (NH4 0.6e-6))
  (WetDeposit (NO3 0.6e-6)	;[kg/m²/mm]
	      (NH4 0.9e-6)))

;; We have some very sandy soil.
(defhorizon top default
  (hydraulic M_vG 
	     (K_sat 19.3)
	     (Theta_res 0.05)
	     (Theta_sat 0.424)
	     (alpha 0.069)
	     (n 1.527))
  (SOM_fractions 0.66 0.34)
  (SOM_C_per_N 11 11)
  (clay 8.0)
  (silt 10.5)
  (humus 1.12)
  (coarse_sand 63.4)
  (fine_sand 16.5))

(defhorizon bottom default
  (hydraulic M_vG 
	     (K_sat 64.08)
	     (Theta_res 0.042)
	     (Theta_sat 0.438)
	     (alpha 0.054)
	     (n 2.416))
  (SOM_fractions 0.66 0.34)
  (SOM_C_per_N 11 11)
  (clay 8.0)
  (silt 10.5)
  (humus 0.12)				;Less humus here.
  (coarse_sand 63.4)
  (fine_sand 16.5))

;; We use this column.
(defcolumn JB1_Andeby default
  (Bioclimate default)
  (Groundwater static)
  (Soil (horizons (-20 top) (-250 bottom))
	(zplus -2.5 -5 -10 -15 -20
	       -25 -30 -40 -50 -60 -70
	       -80 -90 -100 -125 -150 -175
	       -200 -225 -250)
	(MaxRootingDepth 60.0)
	(dispersivity 8.0)
	(EpFactor 1.0))
  (SoilWater (h -100.0)
	     (Xi 0.0 ))
  (Nitrification soil
  		 (k_10 2.08333333333e-7) ; 5e-5/24 [1/h]
  		 (k 5.0e-5))		 ; [gN/cm³]
  (Denitrification (K 0.0417)
		   (alpha 0.1))
  (SoilNH4 (M 0.5e-6))
  (SoilNO3 (M 3.0e-6))
  (OrganicMatter (som ((turnover_rate 1.125e-7)
		       (efficiency 0.60 0.60)
		       (fractions 1.0 0.0 0.0 0.0))
		      ((turnover_rate 5.83333333333e-6)
		       (efficiency 0.60 0.60)
		       (fractions 0.9 0.0 0.1 0.0)))
                 (initial_SOM   (-20  4.86)
                                (-40  2.92)
                                (-60  1.46)
                                (-80  0.49)
                                (-100 0.16)
                                (-120 0.03))
		 (smb ((C_per_N 6)
		       (turnover_rate 4.16666666667e-5)
		       (efficiency 0.60 0.60)
		       (maintenance 4.16666666667e-4) ;0.01/24h
		       (fractions 0.0 0.6 0.0 0.4))
		      ((C_per_N 10)
		       (turnover_rate 4.16666666667e-4)
		       (efficiency 0.60 0.60)
		       (maintenance 4.16666666667e-4) ;0.01/24h
		       (fractions 0.0 0.4 0.0 0.6)))
		 (K_NH4 0.020833)	;0.5 / 24.
		 (K_NO3 0.020833)	;0.5 / 24.
		 (am)))



;; We specialize the JB1_Andeby column to use Richards
;; equation and linked reservoirs for water transport, respectively.  
(defcolumn JB1_Richards JB1_Andeby
  (SoilWater (UZtop richards)))

(defcolumn JB1_lr JB1_Andeby
  (SoilWater (UZtop lr)))

;; Run simulation with both columns for comparison.
(column JB1_Richards)

;; Simulation start date.
(time 1986 12 1 1)

;; Spring Barley with ley setup.
(manager
 (cond ((at 1987 3 20 1)
        (plowing))
       ((at 1987 4 4 1)
        (fertilize mineral 
                   (NO3 50.0e-5)        ;[g/cm2] = 50 kg/ha
                   (NH4 50.0e-5)))      ;[g/cm2] = 50 kg/ha
       ((at 1987 4 5 1)
        (progn (sow "Cut Grass")
               (sow "Spring Barley")))
       ((at 1987 9 5 1)
         (progn (harvest "Spring Barley")
;                (harvest "Cut Grass"
;                    (stub 15)              ;Leave 15 cm stub.
;                    (stem 1.00))
                                 ))         ;Harvest everything above stub.
       ((at 1987 9 8 1)
        (fertilize mineral
                   (NO3 40.0e-5)        ;[g/cm2] = 40 kg/ha
                   (NH4 40.0e-5)))      ;[g/cm2] = 40 kg/ha
       ((at 1987 10 10 1)
        (harvest "Cut Grass"
                 (stub 8.)              ;Leave 08 cm stub.
                 (stem 1.00)))          ;Harvest everything above stub.
       ((at 1988 4 1 1)
        (stop))))

(deflog "pond" table1
  (where "pond.tab")
  (when hourly)
  (entries ((path time year))
	   ((path time month))
	   ((path time mday))
	   ((path column "*" Surface pond)
	    (dimension "mm"))))

;; Create these log files.
(output pond Harvest)

;;; test.dai ends here.
